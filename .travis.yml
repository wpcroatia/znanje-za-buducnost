sudo: false

dist: trusty

cache:
  apt: true
  directories:
    # Cache directory for older Composer versions.
    - $HOME/.composer/cache/files
    # Cache directory for more recent Composer versions.
    - $HOME/.cache/composer/files

language:
  - php

php:
  - 7.0
  - 7.1
  - 7.2
  - 7.3
  - "7.4snapshot"

branches:
  only:
    - master
    - develop

env:
  global:
  - 'SFTP_USER=[user]'
  - 'SFTP_PASSWORD=[password]'
  - 'SFTP_KEY=[base64-encoded-rsa-key]'

matrix:
  fast_finish: true
  include:
    - php: 7.3
      env: WP_VERSION=latest WP_MULTISITE=0
    - php: 7.2
      env: WP_VERSION=latest WP_MULTISITE=0
    - php: 7.1
      env: WP_VERSION=latest WP_MULTISITE=0
    - php: 7.0
      env: WP_VERSION=latest WP_MULTISITE=0

  allow_failures:
    # Allow failures for unstable builds.
    - php: "7.4snapshot"

before_install:
  # Speed up build time by disabling Xdebug.
  - phpenv config-rm xdebug.ini || echo 'No xdebug config.'
  # Install PHP CodeSniffer.
  - cd $TRAVIS_BUILD_DIR
  - cd wp-content/themes/znanje-za-buducnost/
  - composer self-update
  - composer clearcache
  - composer install
  - phpenv rehash

script:
  - cd $TRAVIS_BUILD_DIR
  - cd wp-content/themes/znanje-za-buducnost/
  # Search for PHP syntax errors.
  - find -L . -path ./vendor -prune -o -name '*.php' -print0 | xargs -0 -n 1 -P 4 php -l
  # Run PHPCS.
  - composer check-cs . -- --runtime-set ignore_warnings_on_exit 1
